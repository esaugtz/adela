- breadcrumb :catalog_distribution, @distribution
= form_for(@distribution) do |f|
  .row
    .col-md-9
      %h3 Documentar un Recurso de Datos
      - if @distribution.errors.any?
        = render partial: '/layouts/shared/errors', locals: { errors: @distribution.errors }
  .row
    .col-md-9
      .form-group.required
        = f.label :title, class: 'control-label'
        = f.text_field :title, required: true, class: 'form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.title')}"
      .form-group.required
        = f.label :description, class: 'control-label'
        = f.text_area :description, required: true, class: 'autosize form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.dataset.description')}"
      .form-group.required
        = f.label :download_url, 'URL para descargar'
        = f.url_field :download_url, class: 'form-control', required: true, 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.download_url')}"
      .row
        .col-xs-6
          .form-group.required
            = f.label :media_type, class: 'control-label'
            = select_tag :media_type_select, options_for_media_type, class: 'form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.media_type_select')}"
            = f.hidden_field :media_type, value: f.object.media_type, class: 'form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.media_type')}"
        .col-xs-6
          .form-group
            = f.label :format, class: 'control-label'
            = f.text_field :format, value: f.object.format, required: true, class: 'form-control'
      .row
        = f.hidden_field(:temporal)
        .col-xs-6
          .form-group.required
            = f.label :temporal, 'Inicio del período de tiempo cubierto', class: 'control-label'
            %input#init-date.dcat-temporal.datepicker.form-control{ type: "text", placeholder: "Inicio", required: true, 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.temporal.init')}" }
        .col-xs-6
          .form-group.required
            = f.label :temporal, 'Fin del período de tiempo cubierto', class: 'control-label'
            %input#term-date.dcat-temporal.datepicker.form-control{ type: "text", placeholder: "Fin", required: true, 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.temporal.term')}" }
      .row
        .col-xs-6
          .form-group.required
            = f.label :modified, 'Fecha de última modificación de datos',  class: 'control-label'
            = f.text_field :modified, value: f.object.modified&.strftime('%F'), class: 'form-control input-icon datepicker', required: true, 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.modified')}", 'data-placement': 'bottom'
        .col-xs-6
          .form-group.required
            = f.label :byte_size, 'Tamaño en Bytes'
            = f.text_field :byte_size,  class: 'form-control', 'data-toggle': 'tooltip', title: "#{t('tooltip.distribution.byte_size')}"
    .col-md-3
      %p.margin-top
        Los metadatos ayudan a que los usuarios entiendan las características de la información que se está publicando. La documentación es importante porque afecta la calidad de los datos y el potencial de su uso e impacto.
  .row
    .col-xs-9.margin-top-20
      = f.button 'Guardar', type: 'submit', class: 'btn btn-primary btn-lg'
      = link_to 'Cancelar', edit_dataset_path(@distribution.dataset), class: 'btn btn-alt btn-lg'

:javascript
  $(function () {
    $("form").validate({
      errorPlacement: function(error, element) {
        // Find if element has a calendar sibling
        var calendar = $(element).parent().find("i.fa-calendar");
        var hasCalendarField = calendar.length > 0;
        if (hasCalendarField) {
          // Insert error outside .input-group to avoid messing up the style
          error.insertAfter(calendar.parent().parent());
          // Add red border to calendar-icon span element
          calendar.parent().addClass("error");
        } else {
          error.insertAfter(element);
        }
      }
    });

    function onDistributionTemporalChange() {
      var initDate, termDate, dcatTemporal;

      initDate = $('#init-date').val();
      termDate = $('#term-date').val();

      dcatTemporal = initDate + "/" + termDate;
      $('#distribution_temporal').val(dcatTemporal);
    }

    function loadTemporalValues() {
      var initDate, termDate, dcatTemporal;

      dcatTemporal = $('#distribution_temporal').val().split('/');
      initDate = dcatTemporal[0];
      termDate = dcatTemporal[1];

      $('#init-date').val(initDate);
      $('#term-date').val(termDate);
    }

    $.datepicker.setDefaults({ dateFormat: 'yy-mm-dd' });
    loadTemporalValues();
    $('.dcat-temporal').change(onDistributionTemporalChange);
  })
